# TASK000 - 项目架构与技术栈

## 一、核心痛点分析

### 1.1 业务痛点
- **会员管理复杂**：需要追踪会员基本信息、训练数据、会员卡状态等多维度信息
- **入场验证效率低**：传统刷卡方式效率低，需要人脸识别快速入场
- **线上线下割裂**：美团、抖音等平台购买的券需要线下核销，流程繁琐
- **私教课程管理混乱**：教练排课、会员约课、课程冲突等问题难以管理
- **会员卡生命周期管理**：到期提醒、续费、转卡等操作缺乏系统化管理

### 1.2 技术痛点
- **多端协同**：需要支持Web管理后台、微信小程序、硬件设备（摄像头）
- **第三方集成**：需要对接美团、抖音API，以及主流摄像头品牌SDK
- **实时性要求**：人脸识别、课程预约需要实时响应
- **数据一致性**：会员信息、课程信息在多个系统间需要保持一致

## 二、系统架构设计

### 2.1 整体架构
```
┌─────────────────────────────────────────────────────────────┐
│                        前端层 (Frontend)                      │
├─────────────────────────────────────────────────────────────┤
│  React Web管理后台  │  微信小程序  │  H5移动端（可选）        │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                    API网关层 (API Gateway)                    │
├─────────────────────────────────────────────────────────────┤
│  路由转发  │  鉴权认证  │  限流熔断  │  日志监控              │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                   业务服务层 (Business Services)              │
├─────────────────────────────────────────────────────────────┤
│ 用户服务 │ 会员卡服务 │ 课程服务 │ 教练服务 │ 券核销服务    │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                   基础服务层 (Infrastructure)                 │
├─────────────────────────────────────────────────────────────┤
│ 人脸识别服务 │ 消息推送 │ 文件存储 │ 定时任务 │ 缓存服务    │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                    数据层 (Data Layer)                        │
├─────────────────────────────────────────────────────────────┤
│  MySQL  │  Redis  │  OSS对象存储  │  消息队列（可选）        │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                  外部集成层 (External Integration)            │
├─────────────────────────────────────────────────────────────┤
│ 美团API │ 抖音API │ 摄像头SDK │ 微信API │ 短信服务          │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 技术栈选型

#### 后端技术栈 (Golang)
- **Web框架**: Gin (轻量高性能)
- **ORM**: GORM (数据库操作)
- **数据库**: MySQL 8.0+ (主数据库)
- **缓存**: Redis 6.0+ (缓存、分布式锁)
- **配置管理**: Viper
- **日志**: Zap
- **API文档**: Swagger/OpenAPI
- **认证**: JWT
- **定时任务**: Cron
- **图片处理**: imaging
- **HTTP客户端**: Resty (第三方API调用)

#### 前端技术栈 (React)
- **框架**: React 18+
- **状态管理**: Redux Toolkit / Zustand
- **路由**: React Router v6
- **UI组件库**: Ant Design / Material-UI
- **HTTP客户端**: Axios
- **表单处理**: React Hook Form
- **日期处理**: Day.js
- **图表**: ECharts / Recharts
- **构建工具**: Vite

#### 微信小程序
- **框架**: 原生小程序 / Taro / uni-app
- **UI组件**: Vant Weapp / WeUI
- **状态管理**: MobX / Pinia
- **HTTP**: wx.request 封装

#### 基础设施
- **容器化**: Docker
- **CI/CD**: GitLab CI / GitHub Actions
- **监控**: Prometheus + Grafana
- **日志收集**: ELK Stack (可选)

## 三、数据库设计概览

### 3.1 核心数据表
- **用户表** (users): 用户基本信息
- **会员卡表** (membership_cards): 会员卡信息
- **会员卡类型表** (card_types): 会员卡类型配置
- **教练表** (coaches): 教练信息
- **课程表** (courses): 课程信息
- **预约记录表** (bookings): 预约记录
- **签到记录表** (check_ins): 签到记录
- **人脸信息表** (face_records): 人脸特征数据
- **券核销记录表** (voucher_records): 券核销记录
- **操作日志表** (operation_logs): 操作审计日志

### 3.2 数据关系
- 用户 1:N 会员卡
- 用户 1:N 人脸信息
- 用户 N:M 课程 (通过预约记录)
- 教练 1:N 课程
- 会员卡 1:1 会员卡类型

## 四、接口设计规范

### 4.1 RESTful API规范
- **基础路径**: `/api/v1`
- **命名规范**: 小写字母，单词间用连字符分隔
- **HTTP方法**: GET(查询), POST(创建), PUT(更新), DELETE(删除)
- **响应格式**: 统一JSON格式

### 4.2 统一响应结构
```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1234567890
}
```

### 4.3 错误码规范
- 200: 成功
- 400: 请求参数错误
- 401: 未授权
- 403: 无权限
- 404: 资源不存在
- 500: 服务器内部错误

## 五、开发流程与规范

### 5.1 开发流程
1. 需求分析 → 2. 接口设计 → 3. 数据库设计 → 4. 后端开发 → 5. 前端开发 → 6. 联调测试 → 7. 上线部署

### 5.2 代码规范
- **Golang**: 遵循 Effective Go 规范
- **React**: 遵循 Airbnb React Style Guide
- **Git提交**: 遵循 Conventional Commits 规范

### 5.3 分支管理
- **main**: 生产环境分支
- **develop**: 开发环境分支
- **feature/xxx**: 功能开发分支
- **hotfix/xxx**: 紧急修复分支

## 六、部署架构

### 6.1 服务器配置建议
- **应用服务器**: 2核4G (最低配置)
- **数据库服务器**: 4核8G (推荐配置)
- **Redis服务器**: 2核2G

### 6.2 域名与证书
- 管理后台: admin.yourdomain.com
- API服务: api.yourdomain.com
- 小程序: 需要备案域名 + SSL证书

## 七、项目里程碑

### Phase 1: 基础功能 (4-6周)
- 用户管理
- 会员卡管理
- 教练管理
- 基础权限系统

### Phase 2: 核心功能 (4-6周)
- 人脸识别入场
- 私教课预约
- 课程管理

### Phase 3: 第三方集成 (2-4周)
- 美团券核销
- 抖音券核销
- 微信小程序

### Phase 4: 优化与上线 (2-3周)
- 性能优化
- 安全加固
- 压力测试
- 正式上线

## 八、风险评估

### 8.1 技术风险
- **人脸识别准确率**: 需要选择成熟的人脸识别SDK
- **第三方API稳定性**: 需要做好降级和重试机制
- **并发性能**: 需要做好压力测试和性能优化

### 8.2 业务风险
- **数据安全**: 涉及身份证等敏感信息，需要加密存储
- **隐私合规**: 人脸数据需要符合《个人信息保护法》
- **业务连续性**: 需要做好数据备份和灾难恢复

## 九、后续任务索引

- TASK001: 用户管理功能
- TASK002: 会员卡管理功能
- TASK003: 人脸识别入场功能
- TASK004: 美团抖音券核销功能
- TASK005: 私教课预约功能
- TASK006: 教练管理功能
- TASK007: 系统基础设施搭建
- TASK008: 微信小程序开发
- TASK009: 数据统计与报表
- TASK010: 系统测试与上线

---
**文档版本**: v1.0  
**创建日期**: 2024  
**更新日期**: 2024  
**负责人**: 待定
