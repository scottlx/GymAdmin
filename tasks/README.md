# 健身房管理系统 - 任务拆解文档

## 项目概述

本项目是一个完整的健身房管理系统,包含用户管理、会员卡管理、人脸识别入场、第三方平台券核销、私教课预约、教练管理等核心功能。

**技术栈**:
- 后端: Golang + Gin + GORM + MySQL + Redis
- 前端: React 18 + Redux Toolkit + Ant Design + Vite
- 小程序: 微信原生小程序 / Taro
- 基础设施: Docker + GitLab CI

## 核心痛点分析

### 业务痛点
1. **会员管理复杂**: 需要追踪会员基本信息、训练数据、会员卡状态等多维度信息
2. **入场验证效率低**: 传统刷卡方式效率低,需要人脸识别快速入场
3. **线上线下割裂**: 美团、抖音等平台购买的券需要线下核销,流程繁琐
4. **私教课程管理混乱**: 教练排课、会员约课、课程冲突等问题难以管理
5. **会员卡生命周期管理**: 到期提醒、续费、转卡等操作缺乏系统化管理

### 技术痛点
1. **多端协同**: 需要支持Web管理后台、微信小程序、硬件设备(摄像头)
2. **第三方集成**: 需要对接美团、抖音API,以及主流摄像头品牌SDK
3. **实时性要求**: 人脸识别、课程预约需要实时响应
4. **数据一致性**: 会员信息、课程信息在多个系统间需要保持一致

## 任务列表

### TASK000 - 项目架构与技术栈 ✅
**文件**: `TASK000_项目架构与技术栈.md`

**内容概要**:
- 核心痛点分析
- 系统架构设计(分层架构图)
- 技术栈选型(后端、前端、小程序、基础设施)
- 数据库设计概览
- 接口设计规范
- 开发流程与规范
- 部署架构
- 项目里程碑
- 风险评估

**关键产出**:
- 完整的技术架构方案
- 技术栈选型依据
- 开发规范文档

---

### TASK001 - 用户管理功能 ✅
**文件**: `TASK001_用户管理功能.md`  
**优先级**: P0 (核心功能)  
**预计工期**: 2-3周  
**依赖任务**: 无

**功能模块**:
1. **用户基本信息管理**
   - 数据库设计(用户表、训练统计表)
   - 后端API开发(CRUD操作)
   - 前端页面开发(列表、详情、编辑)
   - 头像上传功能

2. **用户训练数据统计**
   - 签到功能实现
   - 训练数据统计与展示
   - 数据可视化(图表)

3. **用户状态管理**
   - 用户状态变更(冻结、解冻、黑名单)
   - 状态变更记录

4. **用户导入导出**
   - 批量导入用户(Excel)
   - 导出用户数据

**关键产出**:
- 完整的用户管理API(17个接口)
- 用户列表、详情、编辑页面
- 训练数据统计页面
- 导入导出功能

---

### TASK002 - 会员卡管理功能 ✅
**文件**: `TASK002_会员卡管理功能.md`  
**优先级**: P0 (核心功能)  
**预计工期**: 3-4周  
**依赖任务**: TASK001

**功能模块**:
1. **会员卡类型管理**
   - 卡类型配置(时长、价格、权益、规则)
   - 卡类型启用/停用

2. **会员卡办理与续费**
   - 开卡功能(卡号生成、日期计算)
   - 续费功能(支持不同卡类型续费)

3. **会员卡冻结与解冻**
   - 冻结功能(次数/天数限制)
   - 解冻功能(自动调整结束日期)

4. **会员卡转让**
   - 转卡功能(手续费计算)
   - 转让记录

5. **会员卡到期管理**
   - 到期提醒(定时任务)
   - 自动续费(可选)

6. **会员卡查询与统计**
   - 会员卡列表与查询
   - 统计报表(销售趋势、续费率)

**关键产出**:
- 5张数据库表
- 完整的会员卡管理API
- 会员卡管理页面
- 到期提醒定时任务
- 统计报表页面

---

### TASK003 - 人脸识别入场功能 ✅
**文件**: `TASK003_人脸识别入场功能.md`  
**优先级**: P1  
**预计工期**: 3-4周  
**依赖任务**: TASK001, TASK002

**功能模块**:
1. **人脸数据管理**
   - 人脸录入(质量检测、活体检测)
   - 人脸删除/更新

2. **摄像头设备对接**
   - 支持主流品牌(海康、大华、宇视等)
   - 统一设备接口抽象层
   - 设备注册与认证

3. **人脸识别入场**
   - 识别流程(捕获→识别→验证→签到)
   - 识别参数配置

4. **异常处理**
   - 识别失败处理
   - 设备故障处理

5. **管理后台**
   - 设备管理
   - 人脸库管理
   - 识别记录查询

**关键产出**:
- 3张数据库表
- 人脸识别SDK集成
- 设备适配器(至少2个品牌)
- 人脸录入界面
- 设备管理页面
- 识别记录查询页面

**技术要点**:
- 识别准确率>98%
- 识别速度<1秒
- 人脸数据加密存储
- 符合《个人信息保护法》

---

### TASK004 - 美团抖音券核销功能 ✅
**文件**: `TASK004_美团抖音券核销功能.md`  
**优先级**: P1  
**预计工期**: 2-3周  
**依赖任务**: TASK001, TASK002

**功能模块**:
1. **美团平台对接**
   - 美团API集成(OAuth2.0授权)
   - 券查询、核销、撤销接口

2. **抖音平台对接**
   - 抖音API集成
   - 券查询、核销接口

3. **券管理功能**
   - 券列表与查询
   - 券核销界面(扫码/手动输入)

4. **订单同步**
   - 定时同步任务(每15分钟)
   - 订单状态更新

5. **数据统计与报表**
   - 券核销统计
   - 平台分布、核销趋势

**关键产出**:
- 3张数据库表
- 美团/抖音API对接
- 券管理页面
- 券核销界面
- 订单同步定时任务
- 统计报表页面

**技术要点**:
- API调用成功率>99%
- 核销成功率>99%
- 订单同步延迟<15分钟

---

### TASK005 - 私教课预约功能 📝
**文件**: `TASK005_私教课预约功能.md`  
**优先级**: P0 (核心功能)  
**预计工期**: 3-4周  
**依赖任务**: TASK001, TASK006

**功能模块**:
1. **课程管理**
   - 课程类型配置
   - 课程创建与编辑
   - 课程时间管理

2. **预约功能**
   - 会员预约课程
   - 预约冲突检测
   - 预约取消

3. **课程日历**
   - 教练课程日历
   - 会员课程日历
   - 场馆课程日历

4. **签到与评价**
   - 课程签到
   - 课程评价

5. **统计报表**
   - 课程预约统计
   - 教练课程统计
   - 会员上课统计

**关键产出**:
- 课程管理API
- 预约功能API
- 课程日历组件(可视化)
- 预约管理页面
- 统计报表

---

### TASK006 - 教练管理功能 📝
**文件**: `TASK006_教练管理功能.md`  
**优先级**: P0 (核心功能)  
**预计工期**: 2-3周  
**依赖任务**: TASK001

**功能模块**:
1. **教练基本信息管理**
   - 教练注册与认证
   - 教练资质管理
   - 教练状态管理

2. **教练排班管理**
   - 工作时间配置
   - 排班日历
   - 请假管理

3. **教练课程管理**
   - 课程绑定
   - 课程统计

4. **教练业绩统计**
   - 课程数量统计
   - 学员数量统计
   - 收入统计

**关键产出**:
- 教练管理API
- 教练列表、详情页面
- 排班管理页面
- 业绩统计页面

---

### TASK007 - 系统基础设施搭建 📝
**文件**: `TASK007_系统基础设施搭建.md`  
**优先级**: P0 (基础设施)  
**预计工期**: 2-3周  
**依赖任务**: 无

**功能模块**:
1. **项目初始化**
   - 后端项目结构搭建
   - 前端项目结构搭建
   - 代码规范配置

2. **数据库设计与初始化**
   - 数据库表创建脚本
   - 初始数据导入
   - 数据库迁移工具

3. **认证与权限系统**
   - JWT认证
   - RBAC权限模型
   - 权限中间件

4. **日志与监控**
   - 日志收集
   - 错误监控
   - 性能监控

5. **文件存储**
   - OSS对象存储集成
   - 文件上传组件

6. **消息通知**
   - 短信通知
   - 微信模板消息
   - 站内消息

**关键产出**:
- 完整的项目骨架
- 认证与权限系统
- 日志与监控系统
- 文件存储服务
- 消息通知服务

---

### TASK008 - 微信小程序开发 📝
**文件**: `TASK008_微信小程序开发.md`  
**优先级**: P1  
**预计工期**: 3-4周  
**依赖任务**: TASK001, TASK002, TASK005

**功能模块**:
1. **用户端功能**
   - 微信登录
   - 个人中心
   - 会员卡展示
   - 训练数据查看

2. **预约功能**
   - 课程列表
   - 课程预约
   - 我的预约

3. **签到功能**
   - 扫码签到
   - 签到记录

4. **消息通知**
   - 到期提醒
   - 预约提醒
   - 课程提醒

**关键产出**:
- 完整的微信小程序
- 用户端功能页面
- 预约功能页面
- 消息通知功能

---

### TASK009 - 数据统计与报表 📝
**文件**: `TASK009_数据统计与报表.md`  
**优先级**: P2  
**预计工期**: 2-3周  
**依赖任务**: TASK001, TASK002, TASK005

**功能模块**:
1. **运营数据统计**
   - 会员数据统计
   - 会员卡销售统计
   - 课程预约统计
   - 收入统计

2. **数据可视化**
   - 数据大屏
   - 趋势图表
   - 分布图表

3. **报表导出**
   - 日报、周报、月报
   - 自定义报表
   - 报表导出(Excel/PDF)

**关键产出**:
- 统计API
- 数据大屏页面
- 报表管理页面
- 报表导出功能

---

### TASK010 - 系统测试与上线 📝
**文件**: `TASK010_系统测试与上线.md`  
**优先级**: P0  
**预计工期**: 2-3周  
**依赖任务**: 所有功能任务

**功能模块**:
1. **功能测试**
   - 单元测试
   - 集成测试
   - 端到端测试

2. **性能测试**
   - 压力测试
   - 并发测试
   - 性能优化

3. **安全测试**
   - 安全漏洞扫描
   - 渗透测试
   - 数据安全测试

4. **部署上线**
   - 服务器配置
   - 域名与SSL证书
   - CI/CD配置
   - 数据备份策略

5. **运维文档**
   - 部署文档
   - 运维手册
   - 故障处理手册

**关键产出**:
- 完整的测试报告
- 性能优化报告
- 安全测试报告
- 部署文档
- 运维文档

---

## 项目里程碑

### Phase 1: 基础功能 (4-6周)
- ✅ TASK000: 项目架构与技术栈
- ✅ TASK001: 用户管理功能
- ✅ TASK002: 会员卡管理功能
- 📝 TASK006: 教练管理功能
- 📝 TASK007: 系统基础设施搭建

### Phase 2: 核心功能 (4-6周)
- ✅ TASK003: 人脸识别入场功能
- 📝 TASK005: 私教课预约功能
- ✅ TASK004: 美团抖音券核销功能

### Phase 3: 扩展功能 (3-4周)
- 📝 TASK008: 微信小程序开发
- 📝 TASK009: 数据统计与报表

### Phase 4: 测试与上线 (2-3周)
- 📝 TASK010: 系统测试与上线

**总预计工期**: 13-19周 (约3-5个月)

---

## 任务依赖关系

```
TASK000 (架构设计)
    ↓
TASK007 (基础设施) ← 可并行开始
    ↓
TASK001 (用户管理)
    ↓
    ├→ TASK002 (会员卡管理)
    │      ↓
    │      ├→ TASK003 (人脸识别)
    │      └→ TASK004 (券核销)
    │
    └→ TASK006 (教练管理)
           ↓
       TASK005 (私教课预约)
           ↓
       TASK008 (微信小程序)
           ↓
       TASK009 (数据统计)
           ↓
       TASK010 (测试上线)
```

---

## 开发规范

### 代码规范
- **Golang**: 遵循 Effective Go 规范
- **React**: 遵循 Airbnb React Style Guide
- **Git提交**: 遵循 Conventional Commits 规范

### 分支管理
- **main**: 生产环境分支
- **develop**: 开发环境分支
- **feature/xxx**: 功能开发分支
- **hotfix/xxx**: 紧急修复分支

### 接口规范
- **基础路径**: `/api/v1`
- **命名规范**: 小写字母,单词间用连字符分隔
- **HTTP方法**: GET(查询), POST(创建), PUT(更新), DELETE(删除)
- **响应格式**: 统一JSON格式

### 数据库规范
- 表名: 小写字母,单词间用下划线分隔
- 字段名: 小写字母,单词间用下划线分隔
- 必须字段: id, created_at, updated_at
- 软删除: deleted_at

---

## 风险评估

### 技术风险
1. **人脸识别准确率**: 需要选择成熟的人脸识别SDK
2. **第三方API稳定性**: 需要做好降级和重试机制
3. **并发性能**: 需要做好压力测试和性能优化

### 业务风险
1. **数据安全**: 涉及身份证等敏感信息,需要加密存储
2. **隐私合规**: 人脸数据需要符合《个人信息保护法》
3. **业务连续性**: 需要做好数据备份和灾难恢复

---

## 联系方式

如有任何问题,请联系项目负责人。

---

**文档版本**: v1.0  
**创建日期**: 2024  
**最后更新**: 2024
